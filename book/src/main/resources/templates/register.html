<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<title>Insert title here</title>
</head>
<body>
	<div th:insert="~{layout/header}"></div>
	<div class="container">
		<h2>도서등록</h2>
		<form action="register" method="post" name="bookform">
			<div class="mb-3">
				<label for="bookNo" class="form-label">도서번호</label> <input
					type="text" class="form-control" name="bookNo">
			</div>
			<div class="mb-3">
				<label for="bookName" class="form-label">제목</label> <input
					type="text" class="form-control" name="bookName">
			</div>
			<div class="mb-3">
				<label for="bookCoverimg" class="form-label">도서표지</label>
				<textarea class="form-control" name="bookCoverimg" rows="3"></textarea>
			</div>
			<div class="mb-3">
				<label for="bookDate" class="form-label">출판일자</label> <input
					type="text" class="form-control" name="bookDate">
			</div>
			<div class="mb-3">
				<label for="bookPrice" class="form-label">금액</label> <input
					type="text" class="form-control" name="bookPrice">
			</div>
			<div class="mb-3">
				<label for="bookPublisher" class="form-label">출판사</label> <input
					type="text" class="form-control" name="bookPublisher">
			</div>
			<div class="mb-3">
				<label for="bookInfo" class="form-label">도서소개</label> <input
					type="text" class="form-control" name="bookInfo">
			</div>
			<div class="d-grid justify-content-md-end">
				<button type="button" class="btnInsert">등록</button>
			</div>
		</form>
	</div>
</body>
<script>
bookInsert();

const url = "register";

function bookInsert(){
	document.querySelector(".btnInsert").addEventListener("click", function(){

		//파라미터 만들기
		const bookNo = bookform.bookNo.value;
		const bookName = bookform.bookName.value;
		const bookCoverimg = bookform.bookCoverimg.value;
		const bookDate = bookform.bookDate.value;
		const bookPrice = bookform.bookPrice.value;
		const bookPublisher = bookform.bookPublisher.value;
		const bookInfo = bookform.bookInfo.value;
		
		
		const param = {bookNo, bookName, bookCoverimg, bookDate, bookPrice, bookPublisher, bookInfo}  
				
		//등록 요청  (Controller에 정의된 것과 일치 시켜줘야함.)
		fetch(url, { //controller의 주소랑도 동일해야 함.   
			method:"post",  //contrlller에 작성된 PostMapping or GetMapping이랑 일치시쳐줘야하고 
			headers: {
			      "Content-Type": "application/json",
			      // 'Content-Type': 'application/x-www-form-urlencoded',
			    },
			body : JSON.stringify(param), //const const param = {reply, replyer, bno}을 JSON으로 보냄. 
		})
		.then( result => result.text() )
		.then ( result => {alert(result); location.href="/booklist"} ) 
	})
} 

</script>

</html>